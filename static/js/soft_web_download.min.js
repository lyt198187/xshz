(function(e,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t(require("jquery")):typeof define=="function"&&define.amd?define("SoftBtn",["jquery"],t):e.SoftBtn=t()})(this,function(){"use strict";function e(e,t){return e in t}function t(t,n){if(e("forEach",Array))return t.forEach(n);var r=t.slice();for(var i=0;i<r.length;i++){var s=n(r[i],i,r);if(s===!1)break}return}function n(t,n,r){r===void 0&&(r=undefined);if(e("reduce",t))return t.reduce(n,r);var i=t.slice(),s=typeof r=="undefined"?1:0,o=s===1?i[0]:r;for(var u=s;u<i.length;u++)o=n(o,i[u],u,i);return o}function r(t,n){if(e("map",t))return t.map(n);var r=t.slice(),i=[];for(var s=0;s<r.length;s++)i.push(n(r[s],s,r));return i}function i(t,n){if(e("every",t))return t.every(n);var r=t.slice(),i=!0;for(var s=0;s<r.length;s++)if(!n(r[s],s,r)){i=!1;break}return i}function s(t,n){if(e("some",t))return t.some(n);var r=t.slice(),i=!1;for(var s=0;s<r.length;s++)if(n(r[s],s,r)){i=!0;break}return i}function o(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return function(){var n=[];for(var r=0;r<arguments.length;r++)n[r]=arguments[r];var i=e.slice(),s=i[0].apply(i,n);for(var o=1;o<i.length;o++)s=i[o](s);return s}}function u(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];return function(){var r=[];for(var i=0;i<arguments.length;i++)r[i]=arguments[i];return e.apply(void 0,r.concat(t))}}function a(e){return function(){var n=[];for(var r=0;r<arguments.length;r++)n[r]=arguments[r];return e.apply(void 0,n.reverse())}}function f(e,t){for(var n in e){var r=t(e[n],n,e);if(r===!1)break}return}function l(t,n){var r=d(t);if(e("map",r))return r.map(n);var i={};for(var s in r)i[s]=n(r[s],s,r);return i}function c(e){return Object.prototype.toString.call(e)==="[object Array]"}function h(e){return typeof e=="function"}function p(e){return e?Object.prototype.toString.call(e)==="[object Object]"&&e instanceof Object:!1}function d(e,t){return t===void 0&&(t={}),!p(e)&&!c(e)?e:(f(e,function(e,n){if(p(e))t[n]=d(e,t[n]||{});else if(c(e)){var i=r(e,function(e){return d(e)});t[n]=i}else if(h(e)){var s=e.toString(),o=(new Function("return "+s))();t[n]=o}else e!==undefined&&(t[n]=e)}),t)}function v(e){var t=[];for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];return n(t,function(e,t){return d(t,e)},e)}function m(e,t){t===void 0&&(t=e.length);var n=t||e.length;return function r(){var t=[];for(var i=0;i<arguments.length;i++)t[i]=arguments[i];return t.length<n?function(){var e=[];for(var n=0;n<arguments.length;n++)e[n]=arguments[n];return r.apply(void 0,t.concat(e))}:e.apply(void 0,t)}}function k(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];y(function(t){b(function(t,n){e[n]=t},t)},t)}function D(e){if(!p(e))return"";var t=[];return b(function(e,n){var r=H(e);t.push(['"'+n+'"','"'+r+'"'].join(":"))},e),"{"+t.join(",")+"}"}function P(e){if(!c(e))return"";var t=g(H,e).join(",");return"["+t+"]"}function H(e){var t;return p(e)?t=D(e):c(e)?t=P(e):t=String(e),t}function R(e,t){return t===void 0&&(t={}),e.replace(q,function(e,n){var r=I(n.split("."),t);return r===undefined?"":p(r)?H(r):r})}function U(e){return c(e)?e:[e]}function W(e){var t=["byte","KB","MB","GB","TB"],n=0,r=+e;while(r>1024)r/=1024,n++;return r.toFixed(1)+t[n]}function X(e){var t=+e,n=new Date(t*1e3),r=n.getFullYear(),i=Q(n.getMonth()+1),s=Q(n.getDate());return r+"-"+i+"-"+s}function V(e){var t=e.indexOf("http://"),n=t===-1?e.indexOf("https://"):t;return e=e.slice(n),e}function J(e){var t=["WinXp","Win2003","Vista","Win7","Win8","Win8.1","Win10"],n=r(e,function(e){return t[+e-1]}),i=n.pop();return i&&n.push(i),n.join("/")}function K(e){var t={1:"\u6536\u8d39",2:"\u514d\u8d39"};return t[+e]}function Q(e){return e<10?"0"+e:""+e}function G(e){switch(typeof e){case"number":return e+"px";case"string":return e.replace(/px$/,"")+"px";default:window.console&&console.log("cannot use addPx since the type is wrong: "+e)}}function tt(){window.console&&console.log(Z)}function it(e){return function(n){var r=[];for(var i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s;return n in e?(s=e[n])[ot()?"ie":"chrome"].apply(s,r):r}}function st(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];window.console&&console.log(e.join(" "))}function ft(e){var t=ot(),n=t?ht():dt();return e in n}function lt(){return document.getElementById("smplugin")}function ct(){return document.getElementById("chromeplugin")}function ht(){var e=pt();return Et(e,[{name:"Call360SafeApp",method:bt},{name:"IsSafeInstalled",method:wt}]),e}function pt(){var e=lt();return e||(e=vt("object",{id:"smplugin",classid:"clsid:467B32FF-C688-40FF-95FC-C7C61247B0AA"}),mt(e)),e}function dt(){var e=ct();return e||(e=vt("embed",{id:"chromeplugin",type:"application/360softmgrplugin",objname:"simples"}),mt(e)),e}function vt(e,t){var n=document.createElement(e);for(var r in t){var i=t[r];try{n[r]=i}catch(s){st("\u86cb\u75bc\u7684IE6/7")}n.setAttribute(r,i)}return n}function mt(e){var t=document.createElement("div");t.style.cssText="position:absolute;left:-99999px;top:-99px;visibility:hidden;",t.appendChild(e),document.body.appendChild(t)}function yt(e,t){var n=ot(),r=it(t);return function(i){var s=[];for(var o=1;o<arguments.length;o++)s[o-1]=arguments[o];try{return gt.apply(void 0,[e[i][n?"ie":"chrome"]].concat(r.apply(void 0,[i].concat(s))))}catch(u){return st("Method '"+i+"' failed to execute under "+(n?"IE":"chrome")+", "+u),"fail"}}}function bt(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var n,r;try{return(n=window.wdextcmd).Call360Safe.apply(n,e),!0}catch(i){try{return(r=window.wdextcmd).Call360Login.apply(r,e),!0}catch(i){throw new Error("fail to invoke 360 safe under IE")}}}function wt(){try{return ht().GetVersion(),!0}catch(e){return!1}}function Et(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n],s=i.name,o=i.method;s in e||(e[s]=o)}}function St(e){var t=rt.getData(e);if(C("download-link",t))return window.location.href=T("download-link",t);var n=function(n){if(n.errno!=0)return;var r=o(T("p2p"),V,N({},"download-link")),i=rt.setData(e);o(r,i)(n),window.location.href=o(rt.getData,T("download-link"))(e)};Y.fetchSoft(U(e)).then(function(e){n(e)})}function Tt(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var r=ot(),i=r?pt():dt(),s=r?"ie":"chrome",o=ut.download[s],u=at.download[s](e,t,n);try{i[o](u)}catch(a){return"fail"}}function Nt(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1),r===void 0&&(r="");var i=ot(),s=i?pt():dt(),o=i?"ie":"chrome",u=ut.downloadBySDIS[o],a=at.downloadBySDIS[o](e,t,n,r);if(i)try{return s[u](a[0],a[1])}catch(f){return st("error->",f),Tt(e,t,n)}try{s[u].apply(s,a)}catch(l){return st("error->",l),"fail"}}var g=m(a(r),2),y=m(a(t),2),b=m(a(f),2),w=m(a(n),2),E=m(a(i),2),S=m(a(s),2),x=m(a(l),2),T=m(function(t,n){var r,i=1e3,s=0;try{b(function u(e,n,o){if(s++>i)throw new Error("pick over limit: "+i);if(t in o)return r=o[t],!1;p(e)&&b(u,e)},n)}catch(o){window.console&&console.log(o,"pick not found: "+t)}return r},2),N=m(function(t,n,r){var i=d(t);return i[n]=r,i},3),C=m(function(t,n){return p(n)?T(t,n)!==undefined:!1},2),L=m(function(t,n){return window.console&&console.log(t,n),n},2),A=m(function(t,n){return n.map(t).join()},2),O=m(function(t,n,r){return n.map(t).ap(r)},3),M=m(function(t,n,r,i){return n.map(t).ap(r).ap(i)},4),_=m(function(t,n,r,i,s){return n.map(t).ap(r).ap(i).ap(s)},5),B=m(function(t){return n(t,function(e,t){return E(function(e){return e!=t},e)&&e.push(t),e},[])},1),j=m(function(t){var n=o(B,g(F))(t);return n.join(",")},1),F=m(function(t){return"["+t+',"",1]'},1),I=m(function(e,t){return n(e,function(e,t){return e[t]},t)},2),q=/{{(.*?)}}/g,z=m(function(t,n){return c(n)?t<=n.length-1?n[t]:n[n.length-1]:n},2),Y={fetchSoft:function(e){var t=function(e){return location.protocol+"//cx.soft.360.cn/soft/getinfo?info=["+e+"]"},n=function(e){return $.ajax({url:e,dataType:"jsonp"})};return o(j,t,n)(e)}},Z={},et=m(function(t,n){p(n)?Z[t]=C(t,Z)?v({},nt(t),n):d(n):Z[t]=d(n)},2),nt=m(function(t){return Z[t]}),rt={setData:et,getData:nt,logData:tt},ot=function(){var e=!1;return function(){var n=window.navigator.userAgent,r=n.indexOf("MSIE ");if(r>0||!!navigator.userAgent.match(/Trident.*rv\:11\./))e=!0;return ot=function(){return e},e}}(),ut={download:{ie:"CallSoftMgrWithParam",chrome:"CallSoftMgrWithParam"},downloadBySDIS:{ie:"Call360App",chrome:"Call360App"}},at={download:{ie:function(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var r=n?"":"&/New=1",i=t?"&/S=1":"";return"/page=12&/DownloadSoft="+e+"&/protocolKeyName=&/start=360baokusoft"+r+i},chrome:function(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var r=n?"":" /New=1",i=t?" /S=1":"";return"/DOWNLOAD="+e+r+i}},downloadBySDIS:{ie:function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1),r===void 0&&(r="");var i=n?"":"&/New=1",s=t?"&/S=1":"",o=r?"&/SetupArg="+r:"",u="/softid="+e+"&/show=1"+s+i+o;return["SoftMgr\\SDIS.exe",u]},chrome:function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1),r===void 0&&(r="");var i=n?"":" /New=1",s=t?" /S=1":"",o=r?" /SetupArg="+r:"",u="/softid="+e+" /show=1 "+s+i+o;return["SoftMgr\\SDIS.exe",u,""]}}},gt=function(){var e=ot();return function(n){var r=[];for(var i=1;i<arguments.length;i++)r[i-1]=arguments[i];(n==="unknown"||!n)&&st((e?"IE":"Not IE")+" environment, and invalid method: "+n);if(e){var s=ht();if(typeof s[n]=="function")return s[n].apply(s,r);switch(r.length){case 0:return s[n]();case 1:return s[n](r[0]);case 2:return s[n](r[0],r[1]);case 3:return s[n](r[0],r[1],r[2]);default:throw st("In IE and "+r.length+" arguments have been passed in, which exceeds expectation!"),new Error("Exceeding Arguments")}}var o=dt();return o[n].apply(o,r)}}(),xt=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1),r===void 0&&(r="");var i=n?Nt:Tt,s=i(e,t,n,r);s==="fail"?(St(e),xt=St):xt=Tt},Ct=function(){function e(e){this.__value=e}return e.prototype.map=function(e){return this},e.of=function(t){return new e(t)},e}(),kt=function(){function e(e){this.__value=e}return e.prototype.map=function(t){return e.of(t(this.__value))},e.of=function(t){return new e(t)},e}(),Lt=function(){function e(e){this.invokeImpure=e}return e.prototype.map=function(t){return new e(o(this.invokeImpure,t))},e.prototype.join=function(){return e.of(this.invokeImpure().invokeImpure())},e.prototype.chain=function(e){return this.map(e).join()},e.prototype.ap=function(e){return e.map(this.invokeImpure())},e.of=function(t){return new e(function(){return t})},e.flatten=function(){var t=[];for(var n=0;n<arguments.length;n++)t[n]=arguments[n];return new e(function(){return g(function(e){return e.invokeImpure()},t).slice()})},e.reduce=m(function(t,n){var r=new e(o(n[0].invokeImpure,t)),i=1;for(var s=i;s<n.length;s++)r=new e(o(n[s].invokeImpure,r.invokeImpure()));return r},2),e}(),At=function(){function e(e){this.promise=e}return e.prototype.map=function(t){return new e(this.promise.then(function(e){return kt.of(t(e))},function(e){return Ct.of(e)}))},e.of=function(t){return new e(t)},e}(),Ot=v({},at,{callSafe:{ie:function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return e},chrome:function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length,r;switch(n){case 1:r=e.concat([""]);break;case 2:r=e.slice();break;default:st("invalid arguments length: "+n+";"),r=e.slice()}return["360safe.exe"].concat(r)}},callOtherExe:{ie:function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return e},chrome:function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length,r;switch(n){case 1:r=e.concat(["",""]);break;case 2:r=e.concat([""]);break;case 3:r=e.slice();break;default:st("invalid arguments length: "+n+";"),r=e.slice()}return r}},isAppInstalled:{ie:function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return e},chrome:function(e,t){t===void 0&&(t="InstallAppPath");var n=[];for(var r=2;r<arguments.length;r++)n[r-2]=arguments[r];return[e,t].concat(n)}}}),Mt=v({},ut,{getSMVersion:{ie:"GetSoftMgrFileVersion",chrome:"GetSoftMgrFileVersion"},getSafeVersion:{ie:"unknown",chrome:"Get360SafeVer"},isSafeInstalled:{ie:"IsSafeInstalled",chrome:"IsSafeInstalled"},isSMInstalled:{ie:"unknown",chrome:"IsSoftMgrInstalled"},callSafe:{ie:"Call360SafeApp",chrome:"Call360SafeApp"},callSM:{ie:"CallSoftMgrWithParam",chrome:"CallSoftMgrWithParam"},callOtherExe:{ie:"Call360SafeApp",chrome:"Call360SafeApp"},isAppInstalled:{ie:"IsAppInstall",chrome:"IsAppInstall"},callApp:{ie:"CallApp",chrome:"CallApp"}}),_t="0.3.1",Dt=yt(Mt,Ot),Pt={ev:"[data-role=360btn]",originEv:"[data-role=360btn]",type:1,softId:"none",btnName:{normal:"\u666e\u901a\u4e0b\u8f7d",client:"\u4e00\u952e\u4e0b\u8f7d",text:"\u4e0b\u8f7d"},option:{},afterRender:function(e){return undefined},clickCb:function(e){return undefined},height:28,fontSize:14,bgClr:"33cb63",silent:!1,callAppDownload:!1,extraParams:"",selectorMap:{container:".item",img:"img",title:".title",system:".sys-detail",update:".time",type:".type",free:".free",size:".size"}},Ht=function(){function e(t){var n=v({},Pt,t);k(e,n),e.init(n.ev)}return e.getSMVersion=function(){return Dt("getSMVersion")},e.getSafeVersion=function(){return Dt("getSafeVersion")},e.isSafeInstalled=function(){return Dt("isSafeInstalled")},e.isSMInstalled=function(){return Dt("isSMInstalled")},e.callSafe=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return Dt.apply(void 0,["callSafe"].concat(e))},e.callSM=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return Dt.apply(void 0,["callSM"].concat(e))},e.callOtherExe=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return Dt.apply(void 0,["callOtherExe"].concat(e))},e.isAppInstalled=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return Dt.apply(void 0,["isAppInstalled"].concat(e))},e.callApp=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return Dt.apply(void 0,["callApp"].concat(e))},e.openSafe=function(t){var n={downloadUrl:"",useFallback:!0,param:[""]},r=v({},n,t),i=r.downloadUrl,s=r.useFallback,u=r.param,a=m(function(t,n){!n&&t&&(window.location.href=i)},2),f=function(e){return e!=="fail"},l=o(e.callSafe,f,a(s));return l.apply(void 0,u)},e.bindEvent=function(t){$("body").off("click",t).on("click",t,function(t){var n=function(e){return e.data("softid")},r=o($,n,u(e.mightyDownload,e.silent,e.callAppDownload,e.extraParams));r(this),e.clickCb(t)}).off("mouseover",t).off("mouseout",t).on("mouseover",t,function(){e.toggleBgClr($(this),e.hovBgClr,!0)}).on("mouseout",t,function(){e.toggleBgClr($(this),e.hovBgClr,!1)})},e.isFrame=function(e){return $(e).length===0},e.preRenderSingle=function(t){var n=$(e.tplSel).html();return R(n,t)},e.preRender=function(t){return g(e.preRenderSingle,t).join("")},e.gatherInfoFromDom=function(t){var n={softId:t.data("softid"),showType:t.data("type"),btnName:t.data("btnname")};return v({},{showType:1,btnName:e.btnName},n)},e.render=function(t){$(t).each(function(t,n){var r=$(n),i=r.data("softid");e.renderSingle(r,i)})},e.getText=function(t){var n=function(e){return T(e,T("btnName",t))};return o(T("showType"),e.convertTypeToStr,n)(t)},e.resetBtn=function(e){e.html("")},e.convertTypeToStr=function(t){switch(t){case 1:case 2:return e.supportOneBtn()?"normal":"client";case 3:return"text"}},e.gatherAllSoftIds=function(e){return $.map($.makeArray($(e)),function(e){return $(e).data("softid")})},e.deconstruct=function(e){var t=e.soft_id,n=e.bname,r=e.logo[72],i=e.baoku_cate.name,s=e.edition_info.default_edition,o=s.down["default"],u=o.p2p,a=o.size,f=s.free.flag,l=s.pubtime,c=s.version,h=s.os.ver;return{softId:t,name:n,img:r,"game-type":i,"download-link":V(u),size:W(a),type:K(f),update:X(l),version:c,systems:J(h)}},e.init=function(t){var n=function(t){return rt.setData(t.softId,v({},t,e.option))},r=Lt.of(t),i=g(e.render,r),s=g(e.bindEvent,r),u=x(o(e.deconstruct,n));if(e.isFrame(t)){var a=g(U,[e.softId,e.type,e.btnName]),f=a[0],l=a[1],c=a[2],h=g(function(e,t){return{softId:z(t,f),type:z(t,l),btnName:z(t,c)}}),p=o(h,e.preRender)(e.softId);$("body").append(p)}var d=function(e){if(e.errno!=0)return;u(e.data),i.invokeImpure(),s.invokeImpure()},m=o(e.gatherAllSoftIds,Y.fetchSoft,At.of,g(d));m(t)},e.clickCb=function(e){},e.afterRenderCb=function(e){},e.prototype.init=function(){},e.then=function(e){e()},e.download=Tt,e.linkDownload=St,e.mightyDownload=xt,e.version=_t,e.supportOneBtn=function(){var e=ot(),t=ft(Mt.download[e?"ie":"chrome"]);return function(){return t}}(),e.isIE=ot(),e.getPlugin=function(){return ot()?ht():dt()},e.renderSingle=m(function(n,r){var i=Lt.of(e),s=Lt.of(r),o=Lt.of(n),u=g(T("bgClr"),i),a=g(T("bgUrl"),i),f=g(T("height"),i),l=g(T("fontSize"),i),c=g(e.resetBtn,o),h=M(e.renderBtnBg,o,u,a),p=O(e.renderHeight,o,f),d=O(e.renderFontSize,o,l),v=O(e.renderBtnText,o,s),m=g(e.afterRenderCb,g(rt.getData,s));c.invokeImpure(),h.invokeImpure(),p.invokeImpure(),d.invokeImpure(),v.invokeImpure(),m.invokeImpure()},2),e.convertSoftDataToAllData=m(function(t,n){return v({},n,{btnName:Pt.btnName},t)},2),e.togglePic=m(function(n,r){var i=+T("showType",r);if(i===2){var s=e.selectorMap,o=n.closest(s.container);o.addClass("show").find(s.title).html(r.name).end().find(s.img).attr("src",r.img).end().find(s.system).html(r.systems).end().find(s.update).html(r.update).end().find(s.type).html(r["game-type"]).end().find(s.free).html(r.type).end().find(s.size).html(r.size)}return r},2),e.renderBtnText=m(function(n,r){var i=o(rt.getData,e.convertSoftDataToAllData(e.gatherInfoFromDom(n)),e.togglePic(n),e.getText),s=$("<div></div>").css({height:"100%",width:"100%","z-index":10});s.text(i(r)),n.append(s)},2),e.renderBtnBg=m(function(t,n,r){if(r){var i=$("<img src="+r+' height="100%" width="100%"/>').css({position:"absolute",top:0,left:0,display:"block",border:"none",outline:"none","z-index":-1});t.css({background:"none"}).append(i)}else n&&t.css({"background-color":"#"+n})},3),e.toggleBgClr=m(function(n,r,i){if(!r)return;var s=e.bgClr?e.bgClr:"33cb63";n.css({"background-color":i?"#"+r:"#"+s})},3),e.renderHeight=m(function(t,n){t.css({height:G(n),lineHeight:G(n)})},2),e.renderFontSize=m(function(t,n){t.css({fontSize:n})},2),e.silent=!1,e.callAppDownload=!1,e.extraParams="",e.tplSel="#tpl",e.height=18,e.fontSize=14,e.bgClr="33cb63",e}();return Ht});